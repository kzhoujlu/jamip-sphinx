## 4.2 基于VASP软件的高通量计算任务流程

任务(*task*)是JAMIP进行DFT计算的基本单元，每个任务对应特定的计算需求，通过一次或多次VASP计算实现。下面将介绍JAMIP目前所有已实现的计算任务流程。

### 4.2.1 自洽场计算与结构优化

#### 自洽场计算

**任务名：** `scf`
**任务依赖：** `relax/None` (根据relax任务是否存在自动确定)

自洽场计算是VASP计算的基础，主要提供以下功能：

1.  计算部分性质的准确值，如形成能、真空能级等
2.  输出电荷密度( CHGCAR )，波函数( WAVECAR )文件，用于后续的非自洽计算。

#### 结构优化

**任务名：** `relax`
**其他任务名：** `shape volume ions` (根据优化自由度，自动设置优化方案)
**任务依赖：** `None`

VASP通过ISIF参数控制结构优化的自由度(离子位置，单元体积和单元形状)。默认情况下，JAMIP进行全放开优化( 在`.incar`内设置`ISIF=3`)。
如果`.incar`的任务字典未设置ISIF参数，用户可使用任务自由度指定任务名。例如:

    vasp.tasks = 'ions'   # 仅优化离子自由度，即ISIF=2

在执行结构优化任务时，单次VASP计算往往不能到达预期的收敛标准，而增加步长可能在错误结构上浪费更多时间。
JAMIP支持下述优化方案：

*   首先，进行若干步低精度的结构优化，使结构快速弛豫到平衡位置附近
*   然后，进行有限步数的正常精度优化，直至结构到达收敛标准或优化步数到达上限。
    根据我们我们长期的研究经验，采取分步优化、逐渐提高计算精度参数的方案，可以显著缩短结构优化的时间。

默认情况下，JAMIP进行两次粗优化(精度逐渐增加)，至多三次标准精度的优化。如果全部优化计算结束后，计算仍未到达设定的收敛标准，视为结构优化任务失败，JAMIP将不再进行其他依赖于结构优化结果的计算任务。

    # input设置参数
    vasp.tasks = 'relax'     
    vasp.accelerate = True   # 开启粗优化计算，默认关闭
    vasp.accelerate = [{"kspacing":0.5,"ediff":1e-3,"istart":0,"nsw":20}, 
                       {"kspacing":0.3,"ediff":1e-4,"ediffg":-0.05,"nsw":20}]
    # 开启粗优化并设置粗优化参数, 列表内的字典对应优化次数和每步参数，这里展示的是粗优化的默认参数
    vasp.optcell = '1 0 0'   # 生成OPTCELL，可以在结构优化过程中，固定指定方向的晶胞参数保持不变
    # 1 0 0 分别对应xyz三个方向，1代表优化该方向的晶胞参数，0代表固定该方向的晶胞参数

**分步优化简述：**
在开展结构优化的实际操作中，不同结构优化至收敛所需的步数不同，部分结构的初态结构与平衡结构之间相差较大，如果仅使用高精度的结构优化，可能需要非常长时间才能弛豫到平衡位置。采用分步优化的策略，逐渐提高计算精度，可以加速收敛过程。
通常情况下，用户可以通过降低k点密度、能量和力的收敛值，实现低精度优化。以VASP计算为例，默认的粗优化参数可设置为：

    step1 : (kspacing=0.5, ediff=1e-3, istart=1, nsw=20)
    step2 : (kspacing=0.4, ediff=1e-4, ediffg=-0.05, nsw=20)

JAMIP在`relax/S0`目录下进行全部的粗优化计算(标准精度在S1-S3)，每步计算后将对CONTCAR和OUTCAR文件进行备份。
如果用户开启了粗优化，无论在粗优化过程中计算是否收敛，程序都将进行至少一步标准精度优化计算。因此不建议为粗优化设置高于正常精度的收敛标准。
如果用户确定计算结构非常接近平衡结构，可以考虑关闭粗优化功能，减少计算次数，节省计算时间。
**补充说明：**

*   在批量计算时，可能出现部分结构未收敛的情况，用户可以参考算例中的方案优化，制定计算流程
*   使用JAMIP数据库的结构操作方法，可以实现批量设置结构中离子的优化自由度(`Selective dynamics`)
*   添加`OPTCELL`可以在优化过程中固定指定方向的晶胞参数（注：仅适用于针对该方法进行预先特殊编译的VASP版本）。
    如果是使用`ioptcell`的vasp版本，用户可直接在`.incar`文件中的对应任务设置。

#### Hubbard U修正

一般认为，d和f电子的DFT误差的主要来源是它们的相关性质。DFT+U方法是一种常用的改进 d 和 f 电子描述的临时方法，其中添加“现场”电位以在强相关电子之间引入原子内相互作用。在VASP中，LDAUTYPE=2 对应 Dudarev 等人提出的势，其形式为：


![png](https://note.youdao.com/yws/api/personal/file/WEBa5625dd22c493378856fc95ef1b551f2?method=download&shareKey=e359705d5d72c79e34778e69e2580b92)

其中 U 和 J 分别是有效的库仑参数和交换参数，n 是具有自旋σ的 d 轨道数 m 的占用数。 原则上，U 和 J 可以根据第一性原理计算。然而，在现实中，U 和 J 的理论值给出的结果很差，因此，这些参数是通过拟合实验数据（例如氧化物带隙或晶格参数）来调整的。
U值来源[https://www.sciencedirect.com/science/article/pii/S0927025611001133]

因为方程只取决于差值 U – J，通常用变量 `$U_{eff}$` 代替 `U – J`。
在JAMIP计算中，默认设置元素的LDAUU=`$U_{eff}$`，LDAUJ=0，LDAUL和LMAXMIX根据元素自动确定。
用户通过在input.py中设置 `vasp.xc_func = 'ldau'` 或在.incar的参数字典中添加`ldau: True` 

**JAMIP生成的参数模板 (以FeO为例)**
```
LDAU = True
LDAUTYPE = 2
LDAUU = 4.0 0.0
LDAUJ = 0.0 0.0
LDAUL = 2 -1
LMAXMIX = 4
```

### 4.2.2 热力学性质

#### 分解焓

**任务名：** `decomposition`
批量计算该结构及其可能的分解产物的能量，给出其潜在分解路径及分解焓。当前，用户需要手动准备计算所需的所有晶体结构文件。后续更新将支持直接从JAMIP数据库中自动搜索获取相关的结构。

#### Convex hull

**任务名：** `convex`
二元相图分析。JAMIP将计算不同元素组成配比相对应它们单质的形成焓，构建二元相图。当前，用户需要手动准备计算所需的所有晶体结构文件。后续更新将支持直接从JAMIP数据库中自动搜索获取相关的结构。

#### Triangle zone

**任务名：** `triangle`
三元相分析。JAMIP将计算不同元素组成配比相对应它们单质的形成焓，构建三元相图。当前，用户需要手动准备计算所需的所有晶体结构文件。后续更新将支持直接从JAMIP数据库中自动搜索获取相关的结构。

### 4.2.3 电子结构

#### 能带结构

**任务名：** `band`
**任务依赖：** `scf`

计算沿指定高对称路径方向的能带结构。
在JAMIP计算任务中，HSE修正带隙、有效质量等计算，均需要根据能带计算结果来确定带边位置。
选择正确的高对称路径是获取可信的能带计算结果的先决条件。JAMIP默认基于晶体结构的空间群和晶格常数，自动确定高对称路径，路径选择参考了[seekpath](https://www.materialscloud.org/work/tools/seekpath)。用户也可选择在`input.py` 文件中手动指定高对称路径，如下所示：

    # input设置参数
    vasp.tasks = 'band'
    vasp.kpath.band = 'Line Model',(\
     "0.0000 0.0000 0.0000 \Gamma",
     "0.5000 0.0000 0.5000 X",
     "0.5000 0.2500 0.7500 W",
     "0.0000 0.0000 0.0000 \Gamma",
     "0.5000 0.5000 0.5000 L",
     "0.5000 0.2500 0.7500 W"), 20
    # 手动设置高对称路径，对任务池中的全部任务都有效
    vasp.band_insert = 30  # 设置插点数，默认为30
    vasp.band_split = True # 设置是否分段计算能带, 默认为False

用户可以通过 `jp -v kpath <structure_file>` 命令，在终端中快速查询指定晶体结构的空间群和推荐的高对称路径
当能带计算的总K点数较多时，可能导致内存不足的现象。JAMIP支持分段计算能带，用户可以根据计算实际情况选择是否启用该功能。

#### 电子态密度

**任务名：** `dos`
**任务依赖：** `scf`
电子态密度计算，获取各轨道电子的能量分布区间。

.incar内的dos参数：

    dos:
       lorbit: 11          # 决定DOSCAR和PROCAR文件的输出内容
       nedos: 3001         # 能量区间的插值数
       ismear: 0           # 高斯涂抹

如果计算获得的DOS图曲线不够光滑，可以尝试：设置 `ISMEAR=-5`、增大NEDOS或缩小态密度计算的能量区间（EMIN和EMAX的值）。

#### 能带分解电荷密度

**任务名：** `partchg`
**任务依赖：** `scf band`
计算价带与导带边处，电子在空间中的分布。计算分两步进行：

1.  从能带计算中提取带边位置，将其添加到网格K点后，执行一次包含带边的自洽计算
2.  根据自洽计算中带边K点位置和能带数，分别计算VBM和CBM处的部分电荷密度



计算完成后的目录结构：

    `-- electric
       `-- partchg
          |-- scf
          |-- cbm
          `-- vbm

自洽计算时，计算参数使用依赖任务的参数，K点网格根据当前任务的kpoints确定。
带边位置由能带计算结果来确定，当计算的晶体结构中不存在带隙时，该计算不会执行
计算依赖正确且收敛的WAVECAR文件

#### STM图拟合计算

**任务名：** `stm`
**任务依赖：** `scf`
计算带边附近一定能量区间内的能带分解电荷密度，可用于模拟扫描电镜图

.incar内的stm参数

    stm:
       lpard: true      # 是否计算能带分解电荷密度
       nbmod: -3        # 控制使用那些带计算分解电荷密度
       eint: -0.1       # 部分电荷密度的能带的能量范围

#### 形变势

**任务名：** `deformation`
**任务依赖：** `scf band`

```math
E_{d} = \frac {\partial E_{edge}}  {\partial (\Delta a/a_0)}
```

计算在价带顶和导带底的能量对应变的一阶导数，其中对带边能量值的比较需要进行能带对齐，材料结构需要建成正交晶胞。
为了计算应变后的带边能量，JAMIP直接从依赖任务中获取带边所在的K点位置(默认为band任务)，并添加到当前的K点网格中，进行一步自洽计算。
由于需要对带边能量进行对齐，用户需要根据材料维度选择添加以下参数：

*   **LVTOT/LVHAR**
    适用于2D材料，输出LOCPOT文件，将提取材料的真空能级并进行能带对齐。
*   **ICORELEVEL**
    适用于3D材料，在OUTCAR内输出各原子的轨道能级，可以选择其中一个深能级进行能带对齐。

.incar内的deformation参数：

    deformation:
       nsw: 0
       lvtot: true         # 输出LOCPOT
       icorelevel: 1       # 输出轨道能级
       axis: x y           # 设置计算的形变方向            
       scale: 0.99 0.995 1.0 1.005 1.01   # 设置形变方向的缩放比例
       parallel: 1         # 设置最大并行数

计算完成后的目录结构：

    `-- electric
        `-- deformation
            |-- 1
            |-- x-0.99
            |-- x-0.995
            |-- x-1.005
            |-- x-1.01
            |-- y-0.99
            |-- y-0.995
            |-- y-1.005
            `-- y-1.01

#### 杂化泛函相关计算

**任务名：** `hse_gap`
**任务依赖：** `scf band`

使用HSE泛函计算带隙。程序执行过程中，会将能带计算（如，PBE等）获得的带边位置添加到网格K点后，合并构成HSE带隙计算所需的KPOINTS文件。
带边位置由能带计算结果来确定，当计算的晶体结构不存在带隙时，该计算不会执行

**任务名：** `hse_band`
**任务依赖：** `scf`
使用HSE泛函计算能带结构，将低网格密度的K点路径添加网格K点后，合并构成HSE能带计算所需的KPOINTS文件。
.incar内的hse\_band参数：

    hse_band:
       mesh: 0.01  # K点的插值密度，插点数 = 倒格矢长度 / mesh

带边位置由能带计算结果来确定，当计算的晶体结构不存在带隙时，计算不会执行

#### 成键轨道分析

**任务名：** `cohp`
**任务依赖：** `scf`

使用lobster程序计算原子轨道耦合态密度
在计算时，需要先使用VASP进行一步态密度计算，再使用 lobster 计算轨道重叠布局COHP

**COHP**项目首页：<http://www.cohp.de/>
如果您在科学出版物中使用了相关计算结果，请引用以下内容：

    Crystal Orbital Hamilton Populations (COHP). Energy-Resolved Visualization of Chemical 
    Bonding in Solids based on Density-Functional Calculations. 
    R. Dronskowski, P. E. Blöchl, J. Phys. Chem. 1993, 97, 8617—8624.

    Crystal Orbital Hamilton Population (COHP) Analysis as Projected from Plane-Wave Basis Sets.
    V. L. Deringer, A. L. Tchougreeff, R. Dronskowski, J. Phys. Chem. A 2011, 115, 5461—5466.

    LOBSTER: A tool to extract chemical bonding from plane-wave based DFT.
    S. Maintz, V. L. Deringer, A. L. Tchougreeff, R. Dronskowski, J. Comput. Chem. 2016, 37, 1030—1035.

    Efficient Rotation of Local Basis Functions Using Real Spherical Harmonics.
    S. Maintz, M. Esser, R. Dronskowski, Acta Phys. Pol. B 2016, 47, 1165—1175.

在.incar文件中，用户可以设置cohp程序的输入参数：

    cohp:
     nedos: 3001              # DOS计算中，使用的vasp参数，可酌情添加
     basisSet: pbeVaspFit2015 # 使用的元素基集
     COHPstartEnergy: -20     # cohp计算的起始能量
     COHPendEnergy: 10        # cohp计算的终点能量
     orbitalwise: true        # 计算轨道耦合的PCOOP和PCOHP(默认为原子耦合)
     basisfunctions:          # 需要计算的元素及其轨道，不同元素需要分行添加
     - Si 3s 3p
     AtomsIndex: 1 5          # 计算cohp键合的原子序号
                              # 以上的能量范围、原子序号，可以自由修改

计算时，将在计算目录生成COHP的输入文件lobsterin：

    basisfunctions Si 3s 3p
    basisSet pbeVaspFit2015
    COHPstartEnergy -20
    COHPendEnergy 10
     
    cohpbetween atom 1 and atom 5 orbitalwise

#### 电荷布局分析

**任务名：** `bader`
利用bader程序计算原子的布局电荷，计算分两步进行:

1.  进行`LAECHG=True`的自洽计算，输出`AECCHG0 AECCHG2`, 合并为总的电荷密度文件，
2.  使用bader程序计算布局电荷
    **bader**项目首页：<http://theory.cm.utexas.edu/henkelman/research/bader/>
    如果您在科学出版物中使用了相关计算结果，请引用以下内容：

<!---->

    W. Tang, E. Sanville, and G. Henkelman 
    A grid-based Bader analysis algorithm without lattice bias, 
    J. Phys.: Condens. Matter 21, 084204 (2009).

    E. Sanville, S. D. Kenny, R. Smith, and G. Henkelman 
    An improved grid-based algorithm for Bader charge allocation, 
    J. Comp. Chem. 28, 899-908 (2007).

    G. Henkelman, A. Arnaldsson, and H. Jónsson, 
    A fast and robust algorithm for Bader decomposition of charge density, 
    Comput. Mater. Sci. 36, 354-360 (2006).

    M. Yu and D. R. Trinkle, 
    Accurate and efficient algorithm for Bader charge integration, 
    J. Chem. Phys. 134, 064111 (2011).

#### 能带反折叠

**任务名：** `unfolding`
基于原胞结构生成能带路径，程序将根据原胞与超胞之间的映射关系，将原胞中的K点映射到超胞中
(注：原胞的倒空间体积大于超胞)，待计算完成后，再将这些超胞能带点反折叠生成原胞能带，根据
波函数基组间的相似度确定置信度。计算流程如下：

    1. 读取超胞结构，使用spglib计算其原胞和转换矩阵，(或读取输入参数中的原胞和转换矩阵)
    2. 按原胞结构确定高对称路径，将高对称路径上的K点通过转换矩阵投影到超胞，
     输出KPOINTS，GPOINTS(每个K点的G格矢偏移量)，KPATH.in(高对称路径信息)
    3. 对超胞进行能带计算
    4. 使用后处理脚本绘制反折叠能带图 

.incar内的unfolding参数：

    unfolding:
       kmesh: 0.01 # 高对称路径在倒空间的插点间隔，0.01已足够进行分析
       dim: 2 2 2 # 可选参数，不使用spglib自动搜索晶胞，而是手动指定超胞大小
       primcell: /home/icsd/Si.vasp # 可选参数，与上一个参数共同使用。
       # 指定原胞结构文件的路径（需要输入绝对路径）

### 4.2.4 力学性质

#### 弹性模量及弹性常数

**任务名：** `elastic`
使用VASP自动计算弹性矩阵的功能(仅适用于三维结构)，可计算材料的弹性模量、体积模量和剪切
模量

#### 泊松比

**任务名：** `poisson`
通过改变初始结构的晶格常数，固定优化方向(若存在真空层则固定原子)，模拟单轴应变下，横截面
方向上的晶格常数变化
计算时将自动设置optcell来固定选中方向的晶格常数。 如果需要计算材料的泊松比方向等于3（即，
分别计算沿晶胞参数a、b和c方向的泊松比），优化时程序会分别沿着三个方向进行缩放，并固定该
方向的晶胞的晶胞参数，同时放开其他方向的晶胞参数，进行结构优化
如果计算的泊松比方向等于2，程序默认为该结构是二维材料。因此，程序会分别沿着指定的方向进
行缩放，同时该方向和真空层方向的晶胞参数将被固定住，只放开优化另一个方向的晶胞参数，进行
结构优化(axis内未出现的方向)

.incar内的poisson参数：

    poisson
       scale: 0.98 0.99 1.00 1.01 1.02 # 缩放系数
       axis: x y z                     # 需要计算的晶格方向
       parallel: 4                     # 并行计算节点数

### 4.2.5 光学性质

#### 光吸收谱相关计算

```math
I(\omega) = (\sqrt 2 \omega) [\sqrt {\epsilon_1(\omega)+\epsilon_2(\omega)}-\epsilon_1(\omega)]^{1/2}
```
其中 `$ \epsilon $`的单位是 1，`$\omega$`的单位是`$m^{-1}$`。VASP的光学计算可以获取不同能量下的介电常数，即`$E$`和`$ \epsilon $`已知，带入上式
```math
I(\omega) =  \sqrt 2E * e /(\hbar C) * [\sqrt {\epsilon_1(\omega)+\epsilon_2(\omega)}-\epsilon_1(\omega)]^{1/2} *1e^{-2}  \ \ \ \  (cm^{-1})

```

<!--```-->
<!--# 原子单位制向国际单位制转换-->
<!--BOLTZMANN_SI = 1.38064852e-23-->
<!--FINE_STRUCT = 7.2973525664e-3  # 精细结构常数 e2/(4πε0cħ)-->
<!--AVOGADRO = 6.022140857e23  # [1/mol]-->
<!--Clight_SI = 299792458.    # [m/s]-->
<!--a0_SI = 5.2917721067e-11  # [m]-->
<!--me_SI = 9.10938356e-31    # [kg]-->
<!--qe_SI = 1.6021766208e-19  # Electron Charge [C]-->
<!---------->
<!--# 国际单位制向原子单位制转换-->
<!--Clight = 1. / FINE_STRUCT-->
<!--EPSILON0 = 1. / (4. * math.pi)-->
<!--MU0 = 1. / (EPSILON0 * Clight**2)-->
<!--MUB = 1. / 2.-->

<!--Meter = 1. / a0_SI-->
<!--Kilogram = 1. / me_SI-->
<!--Coulomb = 1. / qe_SI-->
<!--Second = Clight_SI / Clight * Meter-->
<!--Newton = Kilogram * Meter / Second**2-->
<!--Joule = Newton * Meter-->
<!--Volt = Joule / Coulomb-->
<!--Ampere = Coulomb / Second-->
<!--Ohm = Volt / Ampere-->
<!--Siemens = Ampere / Volt-->
<!--hbar_SI = 1 / (Joule * Second)-->

<!--```-->

**任务名：** `optics`
光学性质计算。如果设置NPAR=1，VASP程序可以同时输出介电函数OPTIC，可用于计算吸收谱和跃迁强度

#### 介电常数

**任务名：** `dielectric`
计算电子和离子的介电函数

#### 激子结合能及波尔半径

**任务名：** `binding`
利用类氢Wannier-Mott模型，首先计算电子和空穴的平均有效质量以及材料的介电常数，代入公式可求得激子束缚能（`$E_B$`）：
```math
E_B = \mu^* R_y / m_0\epsilon^2_\alpha     \tag {1}  
```
其中，`$\mu^*$`为约化激子质量(即`$1 / \mu^* = 1/m^*_e + 1/m^*_h$`)，`$R_y$`为原子Rydberg能量，`$\epsilon_r$`为相对介电常数(晶格介电常数与电子介电常数之和)。
激子波尔半径`$a_{ex}$`可由如下公式计算：
```math
\alpha_{ex} = \alpha_H \epsilon_r m_0 / \mu^* \tag{2}
```
其中`$a_H$`是波尔半径。

#### 自陷态激子

**任务名：** `singlet`
计算单重态激子能量（注：该激子的激发电子和空穴的自旋方向相同）:

*   singlet计算需要读取scf计算的能带结果。需要先开展scf计算，然后才能执行singlet计算。
*   singlet计算前的scf计算，需要打开ispin = 2

**任务名：** `triplet`
计算三重态激子能量（注：该激子的激发电子和空穴的自旋方向相反）:
*   三重态激子的结构优化需要在激发态下进行

#### 非线性二次谐波成像

**任务名：** `shg`
计算材料的非线性二次谐波
正处在测试阶段，近期将提供支持
太阳能电池理论转换效率

**任务名：** `slme`
计算在黑体辐射条件下太阳能光伏材料的最大太阳能电池理论转换效率
正处在测试阶段，近期将提供支持

#### GW计算

**任务名：** `gw`
计算多体系统中的自能。需要先进行光学计算并输出波函数（WAVEDER）
正处在测试阶段，近期将提供支持

### 4.2.6 电输运性质

#### 载流子有效质量

```math
E = ak^2 + bk + c     \tag {1}
```
```math
m^* = \frac {\partial^2 E} {\partial k^2} = \frac {1} {2a} (m^2eV)=\frac {e\hbar^2} {2am_e} (1 m_e)   \tag {2}
```

**任务名：** `emass`
通过拟合在倒空间中正交的三个方向上带边曲率，计算带边位置电子和空隙的有效质量
（即能量对k点波矢量的二阶导的倒数）。
注意：如果带边附近严重偏离抛物线型能带，该计算方法将不适用。
默认带边位置由能带计算结果确定，当计算的晶体结构不存在带隙时，计算不会执行

**任务名：** `boltztrap`
计算电导有效质量。JAMIP需要调用Boltztrap程序，进行相关计算，计算中考虑了能带非抛物线特征、多带耦合等效应。
Boltztrap是由Georg Madsen和David J. Singh共同开发，程序中采用了玻尔兹曼半经典输运理论，通过对能带结构进行插值得到较密K点下的能带结构，进行材料相关输运性质的计算。
项目主页：<http://www.icams.de/content/research/software-development/boltztrap/>
本任务通过调用Boltztrap程序，计算材料的电导有效质量，如果您在科学出版物中使用了相关计算结果，请考虑引用以下内容：

    Madsen, G. K. H., and Singh, D. J. (2006).
    BoltzTraP. A code for calculating band-structure dependent quantities.
    Computer Physics Communications, 175, 67-71

#### 载流子迁移率计算(形变势理论)

二维载流子迁移率公式，其中`$C_{2D}$`为弹性模量，`$E_l$`是形变势常数，`$m*$`为载流子有效质量
```math
\mu = \frac { e \hbar^3 C_{2D}} {k_BT m^{*}m_d E_l^2}  \tag {1}
```
其中形变势和载流子有效质量的计算方法已在前面提到，弹性模量通过计算拉伸/压缩下的系统自由能变化获得，计算公式如下：
```math
C_{2D} = \frac {1} {S_0} \frac {\partial^2 E} {\partial (\Delta l/l_0)^2}     \tag {2}
```
同理，有二维载流子迁移率公式
```math
\mu = \frac { 2\sqrt{2} \pi e \hbar^4 C_{3D}} {3(k_BT)^{3/2}m^{*^{3/2}}E_l^2}  \tag {3}
```
其中弹性模量的计算公式为：
```math
C_{3D} = \frac {1} {V_0} \frac {\partial^2 E} {\partial (\Delta l/l_0)^2}     \tag {2}
```


**任务名：** `mobility`
采用形变势方法计算二维材料的载流子迁移率。首先，计算初始结构的能带结构获取带边位置；
其次，对材料的晶格常数沿着需要计算载流子迁移率的方向，进行晶格缩放`( 0.98,0.99,1.00,1.01,1.02 )`，
计算缩放后结构的VBM/CBM能级位置（注：需要采用真空能级，进行能带对齐）、以及带边处的有效质量；
最后，通过形变势公式计算得到材料的迁移率。

.incar文件中的mobility参数：

    mobility:
     scale: 0.98 0.99 1.00 1.01 1.02 # 晶胞缩放系数
     axis: x y z # 需要计算的载流子迁移率的方向

### 4.2.7 声子及热学性质

声子及热学计算基于Phonopy和Phono3py实现，在进行计算前请确保相关程序已正确安装：

    pip install phonopy phono3py

**Phonopy**项目首页：<http://phonopy.github.io/phonopy/index.html>
如果您在科学出版物中使用了相关计算结果，请引用以下内容：

    First principles phonon calculations in materials science,
    Atsushi Togo and Isao Tanaka, Scr. Mater., 108, 1-5 (2015)

#### 声子谱及声子态密度

**任务名：** `force`
力常数文件( FORCE\_SETS )是Phonopy进行性质计算的基础。
使用Phonopy生成一系列微扰后的超胞结构，提取超胞结构中的原子受力，构建出原子间的二阶力常数。
**任务流程：**

1.  使用自洽计算的结构和dim建立Phonopy类，生成超胞结构
2.  生成子任务池，准备计算输入文件，提交子任务池计算
3.  检查子任务池中的任务是否计算完成。如果完成，更新.status文件

在 .incar 文件的phonopy参数中，除设置VASP参数外，用户还需要设置以下参数：

    force:
       dim: 2 2 2 # 力常数计算所需的扩胞大小，也用于Gruneisen常数计算时指定扩胞大小（共用计算）
       symprec: 1e-3 # Phonopy寻找结构对称性的精度，对全部 Phonopy计算有效。
       # 注：Phonopy中默认为1e-6。 大多数情况下，此精度过高，在一些低对称体系中，
       # 会产生大量需要计算的超胞结构，默认精度设定为1e-3，可以加快这些体系的声子计算。
       parallel: 1 # 并行节点数

如果后续计算需要获取结构的力常数，程序将自动在计算根目录下生成FORCES\_SETS文件的备份

#### 软模相变

**任务名：** `softmode`
沿着声子谱中虚频的方向移动原子，寻找体系能量最低点，通过消除所有的虚频，可以实现找到声子
谱稳定的结构
注意：移动的软模需要保证在位于声子q点的布里渊区以内。所以，如果移动的软模声子为布里渊区
边界上，需要沿着该方向扩胞，使软模声子的q点折叠到第一布里渊区以内。如果软模声子在Gamma
点上，做软膜相变时，无需对结构进行扩胞。
任务流程：

1.  使用自洽计算的结构和dim，建立Phonopy类，读取FORCE\_SETS，生成软模结构
2.  生成子任务池，准备计算输入文件，提交子任务池计算
3.  检查子任务池中的任务是否计算完成。如果完成，更新.status文件

<!---->

    softmode:
     dimension: 1 1 1 # 软模相变的扩胞大小
     q: 0 0 0 # 原点位置
     band_index: 0 # 能带序数
     amplitude: 0.0 15.0 0.5 # 软膜相变范围
     argument: 0 # 相位因子
     parallel: 1 # 并行节点数

#### gruneisen常数

**任务名：** `gruneisen`
通过改变初始结构的晶格常数（缩放晶胞参数），模拟温度效应导致的晶格体积膨胀/收缩现象（来
自于晶格动力学的非谐效应），计算该结构的声子频率随体积的变化率，求得gruneisen常数
**任务流程：**

1.  使用自洽计算的结构和缩放系数建立plus和minus两组结构，使用isif=4进行优化。
2.  使用优化后的结构和dim，建立Phonopy类，生成超胞结构
3.  检查子任务池中的任务是否计算完成。如果完成，更新.status文件

<!---->

     nsw: 50
     isif: 4
     ibrion: 2
     scale: 0.05 # 计算Gruneisen常数时晶胞的缩放系数
     parallel: 1 # 并行节点数

计算完成后，所有计算文件均保存在 phonon/gruneisen 目录下，文件夹结构如下：

    phonon
    |-- force # 力常数计算目录
    |-- softmode # 软模相变计算目录
    `-- gruneisen # Gruneisen计算目录
     |-- plus 
     | |-- relax # 优化目录
     | `-- force # 位移结构
     `-- minus
     |-- relax # 优化目录
     `-- force # 位移结构

#### 零点能

**任务名：** `zpe`
材料在0K下所有声子的基态能量的求和。

#### IR光谱

**任务名：** `ir_spectrum`
正处在测试阶段，近期将提供支持

#### Raman光谱

**任务名：** `raman_spectrum`
正处在测试阶段，近期将提供支持

#### 热导率

**任务名：** `thermal_conductivity`
正处在测试阶段，近期将提供支持

### 4.2.8 其他性质

#### XRD图谱

正处在测试阶段，近期将提供支持

#### Packing factor

正处在测试阶段，近期将提供支持

#### 径向分布函数

正处在测试阶段，近期将提供支持

#### 容差因子及八面体因子（钙钛矿结构）

正处在测试阶段，近期将提供支持

